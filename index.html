<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2025台新信用卡｜9-12月刷卡回饋方案搜尋器</title>

<!-- Open Graph（分享預覽可自行補圖檔） -->
<meta property="og:type" content="website">
<meta property="og:title" content="2025台新信用卡｜9-12月刷卡回饋方案搜尋器">
<meta property="og:description" content="輸入關鍵詞或店名（例：7-11、IKEA、Uber、加油、KKday、LaLaport…）→ 即時比對建議切換方案與依據。">
<meta property="og:url" content="https://你的帳號.github.io/你的repo/">
<meta property="og:image" content="https://你的帳號.github.io/你的repo/social-card.png">
<meta name="twitter:card" content="summary_large_image">

<style>
  :root{
    --bg:#0f1220; --card:#151a2e; --muted:#8fa0c2; --text:#e8eeff; --accent:#6aa6ff;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",PingFang TC,Roboto,"Noto Sans CJK TC","Microsoft JhengHei",sans-serif;background:var(--bg);color:var(--text)}
  header{padding:24px 16px 8px;max-width:980px;margin:0 auto}
  header h1{margin:0 0 6px;font-size:24px;letter-spacing:.5px}
  header p{margin:0;color:var(--muted);font-size:14px}
  .wrap{max-width:980px;margin:12px auto 40px;padding:0 16px}
  .card{background:var(--card);border-radius:14px;padding:16px;border:1px solid rgba(255,255,255,.06);box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  input[type="text"]{flex:1;min-width:260px;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0c1022;color:var(--text);font-size:16px;outline:none}
  input[type="text"]::placeholder{color:#7281a8}
  .btn{padding:11px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0c1022;color:#e8eeff;cursor:pointer}
  .btn:hover{border-color:var(--accent)}
  label.chk{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:14px;white-space:nowrap}
  .hint{color:var(--muted);font-size:13px;margin-top:8px}
  .results{margin-top:16px;display:grid;gap:10px}
  .result{padding:14px;border-radius:12px;background:#0f1530;border:1px solid rgba(255,255,255,.08)}
  .plan{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(106,166,255,.15);border:1px solid rgba(106,166,255,.35);color:#cfe0ff;font-size:12px;margin-right:8px}
  .score{font-size:12px;color:#9fb5e6}
  .why{margin:8px 0 0;color:#cad6ff;font-size:14px;line-height:1.6}
  .badge{display:inline-block;border:1px solid rgba(255,255,255,.18);padding:2px 8px;border-radius:999px;font-size:12px;color:#cbd6ff;margin:2px 6px 0 0}
  .muted{color:var(--muted)}
  .src{margin-top:14px;font-size:12px;color:#aebde6}
  .src a{color:#cfe0ff}
  details{border:1px dashed rgba(255,255,255,.12);border-radius:10px;padding:10px;margin-top:14px}
  summary{cursor:pointer;color:#c7d7ff}
  code{white-space:pre-wrap;word-break:break-all}
</style>
</head>
<body>
<header>
  <h1>2025台新信用卡｜9-12月刷卡回饋方案搜尋器</h1>
  <p>輸入關鍵詞或店名（例：7-11、全家、IKEA、Uber、加油、KKday、LaLaport…）→ 建議切換方案與依據。</p>
</header>

<div class="wrap">
  <div class="card">
    <div class="row">
      <input id="q" type="text" placeholder="輸入關鍵詞或店名…（支援常見同義寫法）" />
      <button class="btn" id="go">搜尋</button>
      <label class="chk"><input type="checkbox" id="holiday" /> 是假日/國定假日嗎？（同時提示「假日刷 2%」。）</label>
    </div>
    <div class="hint">資料依據：台新銀行官方「<span style="white-space:nowrap;">七大刷任你切最高3.8%回饋</span>」。實際回饋請以官網公告與刷卡當下條件為準；MCC 認定以發卡機構/收單行為準。</div>

    <div id="results" class="results"></div>
    <div class="src">官方參考：<a href="https://www.taishinbank.com.tw/TSB/personal/credit/intro/overview/future/f7b68cfa-549d-11f0-b432-0050568c09e3" target="_blank" rel="noopener">台新銀行｜七大刷任你切回饋網頁</a></div>

   </div>
</div>

<script>
/** ========= 資料區（依台新官方分組；最後更新：2025-09-08） =========
 *  每個條目 { name:'店名', plan:'方案', group:'子分類', note?:'補充', tags?:[] }
 */
const DATA = [
  // 1. Pay著刷
  {name:'台新Pay場域', plan:'Pay著刷 3.8%', group:'台新Pay綁定支付', note:'需台新Pay/台灣Pay介面與正確摘要代碼'},
  {name:'新光三越', plan:'Pay著刷 3.8%', group:'台新Pay綁定支付'},
  {name:'IKEA', plan:'Pay著刷 3.8%', group:'台新Pay綁定支付'},
  {name:'路易莎咖啡', plan:'Pay著刷 3.8%', group:'台新Pay綁定支付'},
  {name:'台灣大車隊', plan:'Pay著刷 3.8%', group:'台新Pay綁定支付'},

  // 2. 天天刷 ─ 超商量販
  {name:'7-11', plan:'天天刷 3.8%', group:'超商量販', note:'限台新Pay綁定支付'},
  {name:'全家便利商店', plan:'天天刷 3.8%', group:'超商量販', note:'限台新Pay綁定支付'},
  {name:'家樂福', plan:'天天刷 3.8%', group:'超商量販'},
  {name:'大買家', plan:'天天刷 3.8%', group:'超商量販'},
  // 通勤交通
  {name:'台鐵', plan:'天天刷 3.8%', group:'通勤交通'},
  {name:'高鐵', plan:'天天刷 3.8%', group:'通勤交通'},
  {name:'LINE GO', plan:'天天刷 3.8%', group:'通勤交通'},
  {name:'Yoxi', plan:'天天刷 3.8%', group:'通勤交通'},
  {name:'Uber', plan:'天天刷 3.8%', group:'通勤交通'},
  // 停車租車
  {name:'嘟嘟房', plan:'天天刷 3.8%', group:'停車租車'},
  {name:'Autopass(車麻吉)', plan:'天天刷 3.8%', group:'停車租車'},
  {name:'城市車旅', plan:'天天刷 3.8%', group:'停車租車'},
  {name:'ViViPark', plan:'天天刷 3.8%', group:'停車租車'},
  {name:'USPACE', plan:'天天刷 3.8%', group:'停車租車'},
  {name:'UDRIVE', plan:'天天刷 3.8%', group:'停車租車'},
  {name:'iRent', plan:'天天刷 3.8%', group:'停車租車'},
  {name:'和運租車', plan:'天天刷 3.8%', group:'停車租車'},
  {name:'格上租車', plan:'天天刷 3.8%', group:'停車租車'},

  // 3. 大筆刷 ─ 指定百貨/Outlet/居家裝修
  {name:'遠東SOGO', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'廣三SOGO', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'遠東百貨', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'微風', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'台北101', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'遠東巨城', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'南紡購物中心', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'漢神百貨', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'漢神巨蛋', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'誠品生活', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'Mitsui Shopping Park LaLaport(南港/台中)', plan:'大筆刷 3.3%', group:'指定百貨'},
  {name:'MITSUI OUTLET PARK', plan:'大筆刷 3.3%', group:'指定Outlet'},
  {name:'華泰名品城', plan:'大筆刷 3.3%', group:'指定Outlet'},
  {name:'SKM Park Outlets', plan:'大筆刷 3.3%', group:'指定Outlet'},
  {name:'IKEA', plan:'大筆刷 3.3%', group:'居家裝修'},
  {name:'特力屋', plan:'大筆刷 3.3%', group:'居家裝修'},
  {name:'HOLA', plan:'大筆刷 3.3%', group:'居家裝修'},
  {name:'宜得利', plan:'大筆刷 3.3%', group:'居家裝修'},
  {name:'瑪黑家居', plan:'大筆刷 3.3%', group:'居家裝修'},

  // 4. 好饗刷 ─ 餐飲/外送/售票/指定飯店/樂園/加油充電
  {name:'全臺餐飲', plan:'好饗刷 3.3%', group:'全臺餐飲(符合餐飲MCC)', note:'不含餐券；以MCC為準'},
  {name:'Uber Eats', plan:'好饗刷 3.3%', group:'外送平台'},
  {name:'Foodpanda', plan:'好饗刷 3.3%', group:'外送平台'},
  {name:'拓元售票', plan:'好饗刷 3.3%', group:'展演購票'},
  {name:'KKTIX', plan:'好饗刷 3.3%', group:'展演購票'},
  {name:'年代售票', plan:'好饗刷 3.3%', group:'展演購票'},
  {name:'寬宏售票', plan:'好饗刷 3.3%', group:'展演購票'},
  {name:'OPENTIX 兩廳院', plan:'好饗刷 3.3%', group:'展演購票'},

  // 指定飯店（原有 + 你補充清單）
];

// 追加：指定飯店名單
[
  '台北晶華酒店','礁溪晶泉丰旅','北投晶泉丰旅','台南晶英酒店','太魯閣晶英酒店','蘭城晶英酒店',
  '台北萬豪酒店','高雄萬豪酒店','W HOTEL','台北喜來登大飯店','台北士林萬麗酒店',
  '台北國泰萬怡酒店','台北六福萬怡酒店','林口亞昕福朋喜來登酒店','八里福朋喜來登酒店',
  '桃園喜來登酒店','新竹豐邑喜來登大飯店','宜蘭礁溪福朋喜來登酒店','台東桂田喜來登酒店',
  '澎湖福朋喜來登酒店','然一酒店','煙波花蓮太魯閣','煙波新竹湖濱館','煙波新竹都會館',
  '煙波花蓮館','煙波蘇澳四季雙泉館','煙波宜蘭館','煙波台南館','煙波花時間 宜蘭傳藝','煙波花時間 花蓮',
  '礁溪老爺酒店','知本老爺酒店','新竹老爺酒店','北投老爺酒店','台北老爺酒店',
  '台南老爺行旅','台中大毅老爺行旅','南港老爺行旅','老爺會館台北南西','老爺會館台北林森',
  '台北福華大飯店','石門水庫福華渡假飯店','新竹福華大飯店','台中福華大飯店',
  '溪頭福華渡假飯店','雲林華安大飯店','高雄福華大飯店','墾丁福華渡假飯店',
  '台北漢來大飯店','高雄漢來大飯店','漢來日月行館','台北君悅酒店','高雄洲際酒店','礁溪寒沐酒店'
].forEach(n => DATA.push({name:n, plan:'好饗刷 3.3%', group:'指定飯店'}));

// 5. 數趣刷
DATA.push(...[
  {name:'蝦皮', plan:'數趣刷 3.3%', group:'網購平台'},
  {name:'momo', plan:'數趣刷 3.3%', group:'網購平台'},
  {name:'Coupang', plan:'數趣刷 3.3%', group:'網購平台'},
  {name:'PChome', plan:'數趣刷 3.3%', group:'網購平台'},
  {name:'Yahoo', plan:'數趣刷 3.3%', group:'網購平台'},
  {name:'Amazon', plan:'數趣刷 3.3%', group:'網購平台'},
  {name:'東森', plan:'數趣刷 3.3%', group:'網購平台'},
  {name:'博客來', plan:'數趣刷 3.3%', group:'網購平台'},
  {name:'Richart Mart', plan:'數趣刷 3.3%', group:'網購平台'},
  {name:'Hahow', plan:'數趣刷 3.3%', group:'線上課程'},
  {name:'PressPlay', plan:'數趣刷 3.3%', group:'線上課程'},
  {name:'Amazing Talker', plan:'數趣刷 3.3%', group:'線上課程'},
  {name:'Udemy', plan:'數趣刷 3.3%', group:'線上課程'},
  {name:'Kobo', plan:'數趣刷 3.3%', group:'線上課程/電子書'},
  {name:'Readmoo', plan:'數趣刷 3.3%', group:'線上課程/電子書'},
  {name:'UNIQLO', plan:'數趣刷 3.3%', group:'時尚品味'},
  {name:'GU', plan:'數趣刷 3.3%', group:'時尚品味'},
  {name:'ZARA', plan:'數趣刷 3.3%', group:'時尚品味'},
  {name:'NET', plan:'數趣刷 3.3%', group:'時尚品味'},
  {name:'lativ', plan:'數趣刷 3.3%', group:'時尚品味'},
  {name:'GAP', plan:'數趣刷 3.3%', group:'時尚品味'}
]);

// 6. 玩旅刷
DATA.push(...[
  {name:'海外消費', plan:'玩旅刷 3.3%', group:'外幣/境外', note:'外幣或交易國別非臺灣'},
  {name:'華航', plan:'玩旅刷 3.3%', group:'航空公司'},
  {name:'長榮', plan:'玩旅刷 3.3%', group:'航空公司'},
  {name:'星宇', plan:'玩旅刷 3.3%', group:'航空公司'},
  {name:'虎航', plan:'玩旅刷 3.3%', group:'航空公司'},
  {name:'國泰航空', plan:'玩旅刷 3.3%', group:'航空公司'},
  {name:'華信', plan:'玩旅刷 3.3%', group:'航空公司'},
  {name:'立榮', plan:'玩旅刷 3.3%', group:'航空公司'},
  {name:'Klook', plan:'玩旅刷 3.3%', group:'訂房旅行'},
  {name:'KKday', plan:'玩旅刷 3.3%', group:'訂房旅行'},
  {name:'AIRSIM', plan:'玩旅刷 3.3%', group:'訂房旅行/通信'},
  {name:'Agoda', plan:'玩旅刷 3.3%', group:'訂房旅行'},
  {name:'Booking.com', plan:'玩旅刷 3.3%', group:'訂房旅行'},
  {name:'Trip.com', plan:'玩旅刷 3.3%', group:'訂房旅行'},
  {name:'Airbnb', plan:'玩旅刷 3.3%', group:'訂房旅行'},
  {name:'Hotels.com', plan:'玩旅刷 3.3%', group:'訂房旅行'},
  {name:'Expedia', plan:'玩旅刷 3.3%', group:'訂房旅行'},
  {name:'雄獅旅遊', plan:'玩旅刷 3.3%', group:'訂房旅行'},
  {name:'易遊網', plan:'玩旅刷 3.3%', group:'訂房旅行'},
  {name:'東南旅遊', plan:'玩旅刷 3.3%', group:'訂房旅行'}
]);

// 7. 假日刷
DATA.push({name:'假日通用', plan:'假日刷 2%', group:'節假日不限通路', note:'國內國定例假日（含線上投保/手動刷保費）'});

// 同義詞／別名
const SYNONYMS = {
  '7-11':['7/11','7ELEVEN','7-ELEVEN','統一超商','小七','7 11'],
  '全家便利商店':['全家','FamilyMart','family mart','Fami'],
  'LINE GO':['LINE TAXI','Line Taxi','LINEGO','LINE Go'],
  'Uber':['uber'],
  'Uber Eats':['ubereats','Ubereats','UberEATS','Uber eats'],
  'Foodpanda':['food panda','food-panda','foodpanda','熊貓'],
  'MITSUI OUTLET PARK':['三井outlet','三井Outlet','Mitsui Outlet Park'],
  '遠東SOGO':['SOGO'], '台北101':['101購物中心','Taipei 101'],
  'X-Park':['X Park','xpark','Xpark'],
  'KKTIX':['KKtix','kkTIX'], 'OPENTIX 兩廳院':['OPENTIX','兩廳院'],
  'IKEA':['宜家家居'], 'Agoda':['安可達'], 'Booking.com':['Booking'], 'Trip.com':['Ctrip','攜程'],
  'Hotels.com':['Hotels'], 'Expedia':['智遊網'],
  'LaLaport':['Mitsui Shopping Park LaLaport(南港/台中)','LaLaport 台中','LaLaport 南港'],
  '台灣大車隊':['55688','55688 台灣大車隊'],
  '中油直營':['台灣中油','中油'], '全國加油':['全國加油站'], '台亞直營':['台亞加油站'],

  // 飯店別名（節選）
  '台北喜來登大飯店':['喜來登','Sheraton Taipei'],
  '台北君悅酒店':['君悅','Grand Hyatt Taipei'],
  '台北萬豪酒店':['萬豪','Marriott Taipei'], '高雄萬豪酒店':['Marriott Kaohsiung'],
  'W HOTEL':['W Taipei','W Hotel Taipei'],
  '高雄洲際酒店':['InterContinental Kaohsiung','洲際'],
  '礁溪寒沐酒店':['寒沐'],
  '台北晶華酒店':['晶華','Regent Taipei'],
  '台北國泰萬怡酒店':['Courtyard Taipei'],
  '台北六福萬怡酒店':['Courtyard by Marriott Taipei Downtown'],
  '林口亞昕福朋喜來登酒店':['Four Points Linkou'],
  '桃園喜來登酒店':['Sheraton Taoyuan'], '新竹豐邑喜來登大飯店':['Sheraton Hsinchu'],
  '宜蘭礁溪福朋喜來登酒店':['Four Points Yilan'], '澎湖福朋喜來登酒店':['Four Points Penghu'],
  '台東桂田喜來登酒店':['Sheraton Taitung'],
  '漢來日月行館':['Silks Club','日月行館']
};

// 特別注意事項：方案層級 / 指定商家層級
const SPECIAL = {
  plan: {
    'Pay著刷 3.8%': [
      '限透過台新Pay介面付款；帳單摘要需含「TS*」（台新Pay）或「T-」（台灣Pay）。',
      '超商綁台新Pay單筆上限 NT$3,000；代收/售、禮物卡、儲值不回饋。'
    ],
    '好饗刷 3.3%|全臺餐飲(符合餐飲MCC)': [
      '僅限收單行MCC 5811/5812/5813/5814；餐券不回饋。',
      '聯合信用卡中心小額支付（部分手搖/速食）不回饋；飯店/百貨/外送平台代收的餐飲不回饋。'
    ],
    '好饗刷 3.3%|外送平台': [
      '限交易地臺灣且幣別為新臺幣。'
    ],
    '大筆刷 3.3%|指定百貨': [
      '以簽單商店名稱認定；店中店（如UNIQLO/Apple）不加碼。',
      '微風僅認：微風廣場/南京/松高/信義/南山；其餘據點不加碼。',
      '使用百貨自家支付（skm pay / 101 Pay / Breeze Pay）不加碼。'
    ],
    '大筆刷 3.3%|居家裝修': [
      '含品牌官網；不含蝦皮等電商平台。'
    ],
    '數趣刷 3.3%|網購平台': [
      '蝦皮/PChome 等需為新臺幣；黃金/遊戲點數/票券等常見排除項不回饋（依平台規定）。'
    ],
    '玩旅刷 3.3%|外幣/境外': [
      '海外＝外幣或交易國別非臺灣；部分航空在臺灣扣款即屬國內。'
    ],
    '玩旅刷 3.3%|訂房旅行': [
      '僅平台「平台扣款」認列；選到店付款→收單為飯店/民宿則不屬此類。'
    ],
    '玩旅刷 3.3%|航空公司': [
      '需於航空公司實體或官網購買機票之消費。'
    ],
    '假日刷 2%|節假日不限通路': [
      '國內國定例假日（依人事行政總處）；含線上投保/手動刷保費。'
    ]
  },
  merchant: {
    '7-11': [
      '限台新Pay；OPEN 錢包/全盈等其他支付不回饋。','代收/售、禮物卡、儲值不回饋；單筆上限 NT$3,000。'
    ],
    '全家便利商店': [
      '限台新Pay；Famipay 等其他支付不回饋。','代收/售、禮物卡、儲值不回饋；單筆上限 NT$3,000。'
    ],
    '家樂福': ['以簽單名稱認定（含線上/超市）；美食街/商店街不加碼。'],
    '大買家': ['以簽單名稱認定（含線上）；美食街/商店街不加碼。'],
    '高鐵': [
      '僅官網/APP/臨櫃/自動售票機購票；儲值卡、TR-PASS等不加碼。','以消費日認定；退刷依原回饋率扣回。'
    ],
    '台鐵': [
      '僅官網/APP/臨櫃/自動售票機購票；其他通路不加碼。','以消費日認定；退刷依原回饋率扣回。'
    ],
    '台灣大車隊': ['車上實體卡或 APP 綁卡交易享加碼。'],
    'Uber': ['限臺灣且新臺幣，否則不屬「天天刷」。'],
    'LINE GO': ['切換「天天刷」並以實體卡/行動支付綁定消費可享加碼。'],
    'USPACE': ['僅停車費；不含 App 其他服務。'],
    'UDRIVE': ['僅租借金額；押金、延長/超時/充電/ETC/里程費不含。'],
    '嘟嘟房': ['綁 iParking App 支付不加碼。'],
    'PChome': [
      '不含商店街/支付連/海外代購/旅遊；儲值與電子票券整筆訂單不回饋，請與一般商品分單結帳。'
    ],
    '蝦皮': ['需為新臺幣；黃金/貴金屬、遊戲點數、票券不回饋。']
    // 飯店皆屬「好饗刷｜指定飯店」，不逐一重複
  }
};

// ====== 搜尋索引與規則 ======
function normalize(str){ return (str||'').toLowerCase()
  .replace(/[－—–—]/g,'-').replace(/[／⁄/]/g,'/').replace(/[（）\(\)]/g,'').replace(/\s+/g,'').trim(); }

const INDEX = [];
for(const item of DATA){
  const base = { ...item, key: normalize(item.name) };
  INDEX.push(base);
  const syns = SYNONYMS[item.name] || [];
  for(const s of syns){ INDEX.push({...item, name:item.name, alias:s, key:normalize(s)}); }
}

// 關鍵詞推測（讓「餐廳」等詞也能命中）
const KEY_HINTS = [
  {kw:['餐廳','餐館','餐飲','吃飯','美食','早午餐','咖啡廳','牛排','火鍋','燒肉','手搖飲','速食'],
   map:{plan:'好饗刷 3.3%', group:'全臺餐飲(符合餐飲MCC)', why:'關鍵詞指向「餐飲MCC」。實際以MCC認定為準。', score:65}},
  {kw:['加油','充電','evoasis','evalue'], map:{plan:'好饗刷 3.3%', group:'加油充電', score:65}},
  {kw:['停車','停車場','vivi','uspace','udrive','autopass','嘟嘟房'], map:{plan:'天天刷 3.8%', group:'停車租車', score:65}},
  {kw:['機票','航空','航空公司','飛機'], map:{plan:'玩旅刷 3.3%', group:'航空公司', score:65}},
  {kw:['訂房','旅館','旅遊','旅行','agoda','booking','trip','airbnb','expedia','kkday','klook'], map:{plan:'玩旅刷 3.3%', group:'訂房旅行', score:65}},
  {kw:['百貨','outlet','outlets'], map:{plan:'大筆刷 3.3%', group:'百貨/Outlet', score:65}},
  {kw:['超商','便利商店','量販','家樂福','大買家'], map:{plan:'天天刷 3.8%', group:'超商量販', score:65}},
  {kw:['計程車','叫車','uber','linego','yoxi','大車隊','55688'], map:{plan:'天天刷 3.8%', group:'通勤交通', score:65}},
  {kw:['外送','ubereats','foodpanda','熊貓'], map:{plan:'好饗刷 3.3%', group:'外送平台', score:65}}
];

function search(q, isHoliday){
  const n = normalize(q);
  const seen = new Set();
  const out = [];
  if(!n) return out;

  for(const it of INDEX){
    const key = it.key;
    let score = 0, why = '';
    if(n === key){ score = 100; why = `精確命中「${it.alias? it.alias : it.name}」`; }
    else if(key.startsWith(n) || n.startsWith(key)){ score = 85; why = `前綴近似：${it.name}`; }
    else if(key.includes(n) || n.includes(key)){ score = 75; why = `部分字詞相符：${it.name}`; }
    if(score>0 && it.alias){ score = Math.max(score,95); why = `同義詞/別名命中「${it.alias}」→ 對應 ${it.name}`; }

    if(score>0){
      const sig = it.name + '|' + it.plan + '|' + it.group;
      if(!seen.has(sig)){
        seen.add(sig);
        // 合併特別注意事項：商家 → 方案+子類別 → 方案全域
        const extra = [];
        if (SPECIAL.merchant[it.name]) extra.push(...SPECIAL.merchant[it.name]);
        const planKeyWithGroup = `${it.plan}|${it.group}`;
        if (SPECIAL.plan[planKeyWithGroup]) extra.push(...SPECIAL.plan[planKeyWithGroup]);
        if (SPECIAL.plan[it.plan]) extra.push(...SPECIAL.plan[it.plan]);
        const mergedNote = [it.note, ...extra].filter(Boolean).join('；');

        out.push({name:it.name, plan:it.plan, group:it.group, score, why, note:mergedNote, tags:it.tags||[]});
      }
    }
  }

  // 關鍵詞推測分類
  for(const rule of KEY_HINTS){
    if(rule.kw.some(k=> n.includes(normalize(k)) )){
      out.push({name:q, plan:rule.map.plan, group:rule.map.group, score:rule.map.score, why: rule.map.why || '關鍵詞推測分類'});
    }
  }

  // 假日備選
  if(isHoliday){
    out.push({name:q, plan:'假日刷 2%', group:'節假日不限通路', score:50, why:'你勾選了「是假日」；任何通路皆可適用（含保費），作為備選方案。'});
  }

  out.sort((a,b)=> b.score - a.score || a.plan.localeCompare(b.plan));
  return out;
}

function render(list){
  const box = document.getElementById('results');
  box.innerHTML = '';
  if(list.length===0){
    box.innerHTML = '<div class="result"><span class="muted">沒有找到直覺的對應。試試輸入：店名（如「IKEA」）、情境（如「加油」、「訂房」）。</span></div>';
    return;
  }
  for(const r of list){
    const el = document.createElement('div');
    el.className = 'result';
    el.innerHTML = `
      <div><span class="plan">${r.plan}</span><span class="score">置信分數：${r.score}</span></div>
      <div class="why">理由：${r.why}；歸類為「${r.group}」。${r.note? '（'+r.note+'）' : ''}</div>
      <div class="badge">關鍵：${r.name}</div>
      ${(r.tags && r.tags.length)? r.tags.map(t=>`<span class="badge">${t}</span>`).join(''):''}
    `;
    box.appendChild(el);
  }
}

const $q = document.getElementById('q');
document.getElementById('go').addEventListener('click', ()=> render(search($q.value, document.getElementById('holiday').checked)));
$q.addEventListener('keydown', e=>{ if(e.key==='Enter'){ render(search($q.value, document.getElementById('holiday').checked)); }});
</script>
</body>
</html>
